# WEBAPP2BQWB - Проект `WebApp for BigQuery Integration`
Веб-приложение, которое обращается к BigQuery WB и отдает оттуда клиентские данные (или загружает)

## Описание проекта
Этот проект предоставляет веб-приложение для работы с базой данных Google BigQuery. В проекте реализованы функции для выполнения SQL-запросов к базе данных, авторизации пользователей и обработки HTTP-запросов (GET и POST). Основная цель – обеспечение упрощенного способа выполнения запросов, фильтруя пользователей и убирая риски для безопасности, обеспечение возможности запуска GAS скриптов любыми пользователями таблиц.

---

## Структура проекта
Проект состоит из следующих ключевых файлов:

- **`config.js`**:
  - Содержит список авторизованных функций: `AUTHORIZED_FUNCTIONS`.
  - Содержит данные авторизованных пользователей и их таблиц: `AUTHORIZED_USERS`.

- **`Functions.js`**:
  - Основная логика для выполнения запросов в базу данных BigQuery, включая:
    - Запуск запросов.
    - Пагинацию результатов (подгрузка следующих страниц по токену).
    - Формирование отчетов с опциональными заголовками.

- **`WebApp.js`**:
  - Обрабатывает HTTP GET и POST-запросы.
  - Проверяет авторизацию пользователей и определяет доступные функции.

---

## Основные возможности
1. **Работа с BigQuery:**
   - Выполнение SQL-запросов.
   - Управление результатами запросов с учетом ограничения по страницам.
   - Генерация структурированных отчетов.

2. **Авторизация:**
   - Проверка пользователей по адресу электронной почты и идентификатору Google Sheets.
   - Контроль доступа к функциям через список разрешенных вызовов.

3. **HTTP-запросы:**
   - Обработка GET-запросов для получения быстрых базовых ответов.
   - Обработка POST-запросов для динамического вызова функций и передачи параметров.

---

## Установка и использование

### Установка
1. Разверните проект в среде Google Apps Script:
   - Создайте новый скриптовый проект в Google Apps Script.
   - Копируйте файлы `config.js`, `Functions.js` и `WebApp.js` в проект.
2. Настройте API BigQuery в консоли Google Cloud:
   - Включите BigQuery API для проекта.
   - Создайте сервисный аккаунт для доступа к базе данных.
   - Скачайте JSON-файл ключа и добавьте его в Google Apps Script.

### Использование
1. **HTTP GET-запросы:**
   - Для тестирования можно отправить запрос к вашему развернутому приложению.
   - Пример ответа: `Hello from doGet!`.

2. **HTTP POST-запросы:**
   - Формат POST-запроса:
     ```json
     {
       "functionName": "importWBbaskets",
       "parameters": { "need_headers": true },
       "ssid": "1pAvZCM_cxs1AGl3FzpX-K9JsrgtZwgd4vwHcN6FZ7Yk",
       "userEmail": "anek777@gmail.com"
     }
     ```
   - Возможные параметры зависят от вызванной функции.
   - В ответ на успешный вызов возвращается структурированный JSON.

---

## Пример работы

### Пример POST-запроса

**Запрос:**
```json
{
  "functionName": "importWBbaskets",
  "parameters": { "need_headers": true },
  "ssid": "1pAvZCM_cxs1AGl3FzpX-K9JsrgtZwgd4vwHcN6FZ7Yk",
  "userEmail": "anek777@gmail.com"
}
